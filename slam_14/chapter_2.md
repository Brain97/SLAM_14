
 <script type="text/javascript"
       src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
### 2.2.2 后端优化
主要处理SLAM过程中噪声问题。除了“如何从图像估计运动以外”，还要顾及VO从图像中估计出来的运动有多大噪声，噪声如何从上个时刻传递到下个时刻，以及对当前估计有多大信心。

后端优化的问题，就是**如何从这些带有噪声的数据中估计整个系统的状态（机器人轨迹+地图），以及这个状态估计不确定性有多大**，即**最大后验概率估计(Maximum-a-Posteriori, MAP),**。

前端给后端提供**待优化的数据，以及数据的初始值**。与**计算机视觉领域**更相关，比如**图像特征提取、匹配等**。

后端负责整体优化过程，只考虑**数据，不考虑来自什么传感器**。主要是**滤波，与非线性优化**.

早期的SLAM是一个**状态估计问题**,即**后端优化**问题。当时成为“空间状态不确定性的估计”（**Spatial Uncertaity**）。slam的本质就是**对运动主体自身和周围空间不确定性的估计**。为了解决SLAM，我们需要用**状态估计理论**，把**定位和建图的不确定性**表达出来，然后用**滤波器和非线性优化**，估计**状态的均值和不确定性（方差）**。

###2.2.3 回环检测（Loop Closure Detection）
解决**位置估计随时间漂移**的问题。如果有某种手段，让机器人知道“**回到了原点**” 这件事，或者把**原点**识别出来，然后再把**位置估计拉过去**，就可以消除drift了。

loop closure与**定位和建图**都有密切联系，地图存在的意义就是**让机器人知晓自己到过的地方**。为了实现loop closure，我们需要让机器人有**识别到过的场景的能力**。可以**人为添加标志**，也可**比较图像相似性**。所以，视觉上，lc的问题就是**计算图像相似性**。

检测到loop之后，就把“**A与B是一个点**”这样的信息告诉**optimization**，然后op根据信息，把**轨迹和地图**调整到**符合loop closure**的样子。如果有充分而正确的loop closure detection，就可以**消除累积误差**，得到**全局一致**的地图.

### 2.2.4 建图（Mapping）

建图指**构建地图**的过程。**地图**是对**环境的描述**。
![avatar](地图.png)
不同应用所需要的地图也不同。
1. 对扫地机器人而言，主要在**低矮平面**运动，只需要一个**二维地图**，标记哪里可以通过，哪里有障碍物。
2. 对于一个相机，它有**6个自由度**，至少需要**三维地图**。
3. 若需要一个漂亮的三维重建地图，则不仅需要**一组空间点**，还需要**带纹理的三角面片**.
4. 甚至有些时候，我们只需要知道**那两个点是联通**的。

地图的形式可以分为**度量地图**和**拓扑地图**。

#### 2.2.4.1 度量地图（Metric Map）

**度量地图**强调**精确地**表示地图中**物体的位置关系**，分为**稀疏（Sparse）**和**稠密（Dense）**。

##### 稀疏
稀疏不需要表达所有物体，只选择一部分**我们认为有意义的物体**，称之为**地标（Landmark）**，其他部分被忽略掉。可用于**定位**,，但不可用于**导航**(撞墙)。

##### 稠密
建模**所有看见的物体**。可用于**定位和导航**。稠密地图按照某种分辨率，有许多个小块组成。**二维地图**的是许多**小格子（Grid）**，**三维**的是许多**小方块（Voxel）**。每个小块含有**占据、空闲、未知**三种状态，可以用于判断可否通过。这种方式**耗费大量空间**，且**某些细节部分无用**；另外，大规模度量地图有时会有**一致性问题**。很小的一点误差，可能会导致**两间屋子的墙出现重叠，使地图失效**。

#### 2.2.4.2 拓扑地图（Topological Map）
拓扑地图更强调地图元素间的连通关系。是一个**Graph**。**更为紧凑，但不擅长表达具有复杂结构的地图。如何对地图进行分割形成边，又如何使用拓扑地图进行导航与路径规划**，仍待研究。

## 2.3 SLAM问题的数学表述

变量如下：
* 时间 $t=1,...,K$
* 位置 $x, x_1, x_K$
* 路标 $y, y_1, y_{2}, y_N $

什么是**运动**？即从$k-1$时刻到$k$时刻，robot的位置$**x**$是**如何变化**的。
什么是**观测**？robot在$k$时刻于$x_k$处观测到了一个地标$y_i$，需要考虑如何来表示。

robot可以通过传感器读到自身的运动，比如加速度、加速度、位置差等等。数学模型(**运动方程**)如下：

$$x_k=f(x_{k-1},u_k,w_k)$$

其中$u_k$是**输入**，$w_k$是**噪声**。

此外，还有一个**观测方程**:

$$z_{k,j}=h(y_j,x_k,v_{k,j})$$

描述的在**$x_k$位置**，看到了某个**路标$y_j$**,产生了一个**观测数据$z_{k,j}$**。其中$v_{k,j}$是这次观测的噪声。

针对特定的场合，有多种用**参数化**(**Parameterization**)的方式。比如说
在**平面**运动时，他的**位姿（位置+姿态）**可以用坐标和转角表示，即$x_k=[x,y,\theta]^T_k$表示。同时，任意两个时间间隔之间的变化为
$u_k=[\Delta x,\Delta y,\Delta \theta]_k^T$，此时，
* 运动方程可以表示为
$$ \left[ \begin{array}{c}
x  \\
y  \\
\theta  \end{array} \right]_k=
\left[ \begin{array}{c}
    x \\
    y\\\theta
    \end{array}\right]
_{k-1}+
\left[ \begin{array}{c}
   \Delta x \\
   \Delta y\\
   \Delta \theta
    \end{array}\right]
_{k}+ w_k
$$
* 若带的是二维激光传感器，则**观测方程**可以表示为$$
\left[\begin{array}{c} \gamma\\ \phi\end{array}\right]= 
\left[ \begin{array}{c}\sqrt{(p_x-x)^2+(p_y-y)^2  }\\arctan(\frac{p_y-y}{p_x-x})\end{array} \right]+ v
$$
其中，距离为$\gamma $,夹角为$\phi$.
* 若带的是相机，那么**观测方程**是“**对路标点进行拍摄后，得到图像中像素的过程**”。

slam 的基本过程，即可总结为两个基本方程
$$\left\{\begin{array}{cc} 
		x_k=f(x_{k-1},u_k,w_k)\\ 
		z_{k,j}=h(y_j,x_k,v_{k,j}) 
	\end{array}\right.$$
即，当知道运动测量的读数$u$，以及传感器的读数$z$时，如何求解**定位**($x$)问题和**建图**($y$)问题.此时，slam转化成一个**状态估计问题**:如何通过带有噪声的测量数据，估计内部的、隐藏的状态变量。


###状态估计问题的求解
求解与**两个方程的具体形式（线性/非线性）**，和**噪声分布（高斯/非高斯）**有关。
||高斯|非高斯|
|-|-|-|
|线性|最简单，无偏最优估计有卡尔曼滤波（Kalman Filter）给出||
|非线性||扩展卡尔曼滤波（EKF）/非线性优化|

21世纪早期EKF滤波为主，在工作点处**把系统线性化**，以**预测-更新**两大步骤进行求解。EKF的缺点是（线性化误差和噪声高斯分布），为了克服缺点，逐渐采用**粒子滤波器（Particle Filter）**，以及**非线性优化方法**。目前，主流SLAM有**图优化（Graph Optimization）**来进行状态估计。一般认为图优化>滤波器技术。

### 其他

* 位置， 三维空间中，位置是**3d坐标**，加上绕着**三个轴的旋转**，所以有6个自由度。